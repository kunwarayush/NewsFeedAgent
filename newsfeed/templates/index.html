<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>News Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; background:#eef1f5; margin:0; }
        header { background:#343a40; color:#fff; padding:10px 20px; }
        header h1 { margin:0; }
        .controls { margin-top:10px; display:flex; gap:10px; align-items:center; }
        .controls input, .controls select { padding:4px; }
        #stories { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:15px; padding:20px; }
        .card { background:#fff; border-radius:8px; padding:15px; box-shadow:0 1px 3px rgba(0,0,0,0.1); }
        .card h3 { margin-top:0; }
        .meta { font-size:0.85em; color:#555; margin-bottom:8px; }
        .scores span { margin-right:8px; font-size:0.85em; }
        .refs { padding-left:16px; font-size:0.85em; }
        #loadMore { display:block; margin:20px auto; padding:10px 20px; }
    </style>
</head>
<body>
<header>
    <h1>News Dashboard</h1>
    <div class="controls">
        <label>Stories: <input type="number" id="limit" min="20" max="100" value="20"></label>
        <label>Sort: <select id="sort">
            <option value="latest">Latest</option>
            <option value="trending">Trending</option>
            <option value="top">Top</option>
            <option value="oldest">Oldest</option>
        </select></label>
        <button id="refresh">Refresh</button>
    </div>
</header>
<div id="stories"></div>
<button id="loadMore">Load More</button>
<script>
let offset = 0;
async function loadStories(reset=false){
    const limit = parseInt(document.getElementById('limit').value)||20;
    const sort = document.getElementById('sort').value;
    const res = await fetch(`/stories?limit=${limit}&sort=${sort}&offset=${reset?0:offset}`);
    const data = await res.json();
    if(reset){
        document.getElementById('stories').innerHTML='';
        offset = 0;
    }
    data.forEach(st => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<h3><a href="${st.link}" target="_blank">${st.title}</a></h3>
            <div class="meta">${st.source ? `Source: ${st.source} â€” ` : ''}Category: ${st.category}</div>
            <p>${st.summary || ''}</p>
            <div class="scores">
                <span title="${st.relevance_expl}">Rel: ${st.relevance.toFixed(2)}</span>
                <span title="${st.bias_expl}">Bias: ${st.bias.toFixed(2)}</span>
                <span title="${st.trending_expl}">Trend: ${st.trending.toFixed(2)}</span>
            </div>
            <ul class="refs">${st.references.map(r=>`<li><a href="${r.link}" target="_blank">${r.title}</a></li>`).join('')}</ul>`;
        document.getElementById('stories').appendChild(card);
    });
    offset += data.length;
}

document.getElementById('refresh').addEventListener('click', ()=>loadStories(true));
document.getElementById('loadMore').addEventListener('click', ()=>loadStories());
window.addEventListener('DOMContentLoaded', ()=>loadStories(true));
</script>
</body>
</html>
